#### Action for Harmony input selection
- alias: Harmony Input Selection
  hide_entity: True
  trigger:
    - platform: state
      entity_id: input_select.harmony
      to: 'Watch TV'
    - platform: state
      entity_id: input_select.harmony
      to: 'Watch TV with Surround'
    - platform: state
      entity_id: input_select.harmony
      to: 'Watch TV via PVR'
    - platform: state
      entity_id: input_select.harmony
      to: 'Play PS4'
  action:
    - service: remote.turn_on
      entity_id: remote.living_room
      data_template:
        activity: >
          {% if is_state("input_select.harmony", "Watch TV") %}
            21450129
          {% elif is_state("input_select.harmony", "Watch TV with Surround") %}
            13915533
          {% elif is_state("input_select.harmony", "Watch TV via PVR") %}
            13474528
          {% elif is_state("input_select.harmony", "Play PS4") %}
            13332151
          {% else %}
          {% endif %}

#### Action for Harmony input selection to Power-Off
- alias: Harmony Off
  hide_entity: True
  trigger:
    platform: state
    entity_id: input_select.harmony
    to: 'Power Off'
  action:
    - service: remote.turn_off
      entity_id: remote.living_room

#### Keep Harmony input selection in sync with Harmony Hub        
- alias: Harmony Activity Sync
  hide_entity: True
  trigger:
    - platform: template
      value_template: "{% if is_state_attr('remote.living_room', 'current_activity', 'Watch TV') %}true{% endif %}"
    - platform: template
      value_template: "{% if is_state_attr('remote.living_room', 'current_activity', 'TV and surround') %}true{% endif %}"
    - platform: template
      value_template: "{% if is_state_attr('remote.living_room', 'current_activity', 'Watch TV via PVR') %}true{% endif %}"
    - platform: template
      value_template: "{% if is_state_attr('remote.living_room', 'current_activity', 'Play PS4') %}true{% endif %}"
    - platform: template
      value_template: "{% if is_state_attr('remote.living_room', 'current_activity', 'PowerOff') %}true{% endif %}"
  action:
    - service: input_select.select_option
      entity_id: input_select.harmony
      data_template:
        option: >
          {% if is_state_attr('remote.living_room', 'current_activity', 'Watch TV') %}
            Watch TV
          {% elif is_state_attr('remote.living_room', 'current_activity', 'TV and surround') %}
            Watch TV with Surround
          {% elif is_state_attr('remote.living_room', 'current_activity', 'Watch TV via PVR') %}
            Watch TV via PVR
          {% elif is_state_attr('remote.living_room', 'current_activity', 'Play PS4') %}
            Play PS4
          {% elif is_state_attr('remote.living_room', 'current_activity', 'PowerOff') %}
            Power Off
          {% else %}
          {% endif %}

### Show Home Server Health when powered on        
- alias: Home Server On
  hide_entity: True
  trigger:
    platform: state
    entity_id: sensor.hp_ilo_server_power
    to: 'ON'
  action:
    service: group.set_visibility
    entity_id: group.server1
    data:
      visible: True

### Hide Home Server Health when powered off      
- alias: Home Server Off
  hide_entity: True
  trigger:
    - platform: state
      entity_id: sensor.hp_ilo_server_power
      to: 'OFF'
    - platform: homeassistant
      event: start
  condition:
    # condition needed for homeassistant startup trigger
    condition: state
    entity_id: sensor.hp_ilo_server_power
    state: 'OFF'
  action:
    service: group.set_visibility
    entity_id: group.server1
    data:
      visible: False

### Show Samsung TV control when powered on
- alias: Samsung Tv On
  hide_entity: True
  trigger:
    platform: state
    entity_id: media_player.samsung_tv
    to: 'on'
  action:
    service: group.set_visibility
    entity_id: group.samsung_tv
    data:
      visible: True
 
 ### Hide Samsung TV control when powered off
- alias: Samsung Tv Off
  hide_entity: True
  trigger:
    - platform: state
      entity_id: media_player.samsung_tv
      to: 'off'
    - platform: homeassistant
      event: start
  condition:
    # condition needed for homeassistant startup trigger
    condition: state
    entity_id: media_player.samsung_tv
    state: 'off'
  action:
    service: group.set_visibility
    entity_id: group.samsung_tv
    data:
      visible: False
      
### Turn off lights in morning when everyone leaves home
- alias: 'Away Mode - Lights Off'
  trigger:
    platform: state
    entity_id: group.all_devices
    to: 'not_home'
  condition:
    condition: and
    conditions:
      - condition: sun
        after: sunrise
        # Optional offset value
        before_offset: "-00:15:00"
      - condition: time
        before: '11:30:00'
      - condition: state
        entity_id: group.all_lights
        state: 'on'
  action:
    - service: light.turn_off
      entity_id: group.all_lights
    - service: notify.notify
      data_template:
        message: "Lights turned off"
          
### Turn on kitchen light in evening when someone enters home
- alias: 'Arrive Home - Kitchen Light On'
  trigger:
    platform: state
    entity_id: group.all_devices
    to: 'home'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: light.1_kitchen
        state: 'off'
      - condition: or
        conditions:
        - condition: sun
          after: sunset
          after_offset: "-00:30:00"
        - condition: state
          entity_id: sun.sun
          state: below_horizon
  action:
    - service: light.turn_on
      entity_id: light.1_kitchen
    - service: notify.notify
      data_template:
        message: "Kitchen Light turned on"
      
### Flash lights when Ashlei arrives home
- alias: 'Ashlei Home - Flash Lights'
  trigger:
    platform: state
    entity_id: device_tracker.iphone_6_plus
    to: 'home'
  action:
    - service: light.lifx_effect_pulse
      entity_id: group.all_lights
      data:
        brightness: 180
        color_name: pink
        period: 0.5
        cycles: 2
    # - service: notify.notify
      # data_template:
        # message: "Ashlei has arrived home"

### Flash lights when Nick arrives home
- alias: 'Nick Home - Flash Lights'
  trigger:
    platform: state
    entity_id: device_tracker.lg_g4
    to: 'home'
  action:
    - service: light.lifx_effect_pulse
      entity_id: group.all_lights
      data:
        brightness: 180
        color_name: blue
        period: 0.5
        cycles: 2
    # - service: notify.notify
      # data_template:
        # message: "Nick has arrived home"